-- 코드를 입력하세요
SELECT  A.CAR_ID, A.CAR_TYPE, ROUND(A.daily_fee * 30 * (100 - C.DISCOUNT_RATE)*0.01,0) as FEE
FROM CAR_RENTAL_COMPANY_CAR as A
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN as C on C.CAR_TYPE = A.CAR_TYPE
WHERE A.daily_fee * 30 * (100 - C.DISCOUNT_RATE)*0.01 BETWEEN 500000 and 2000000 and C.DURATION_TYPE = '30일 이상' and  A.CAR_TYPE in ('세단', 'SUV') and A.CAR_ID not in (SELECT CAR_ID
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY 
WHERE (START_DATE < '2022-11-01' and END_DATE > '2022-11-01') or (END_DATE > '2022-11-30' and START_DATE < '2022-11-30'))
ORDER BY FEE desc, A.CAR_TYPE, A.CAR_ID desc;